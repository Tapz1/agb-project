{% extends 'layout.html' %}
{% set active_page = "admin" %}
{% block body %}

<div>
   {% include 'includes/_messages.html' %}

    <h1>Admin Portal</h1>
    <hr>
    <h4 class="font-weight-lighter">Hi, {{ name }}.
        <br> You can approve pending testimonials here.
    </h4>
    <br>
</div>


<div class="container-md">
    <form method="post" action="" class="">
        {% for field in form %}
        <div class="row align-items-center">
            <div class="col-4 text-md admin-forms font-med-bold">
                <label>Send a testimonial request</label>
            </div>
            <div class="row align-items-start admin-forms">
                <div class="col-4">
                    {{field(class="form-control", placeholder="Email")}}
                </div>
                <div class="col-md-auto" style="">
                    <button type="submit" class="btn btn-outline-success" name="send-request">Send</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </form>
</div>
{% set type = new %}
{% from "includes/_formhelpers.html" import render_field %}
<div class="container-md" style="margin-bottom: 20px;">
        <div class="row align-items-end">
            <!--{% from "includes/_formhelpers.html" import render_field %}-->
            <div class="col-4 text-md admin-forms font-med-bold" style="margin-top: 10px;">
                <h1 class="display-6">Upload Images</h1>
            </div>
        </div>

        <div class="row justify-content-center text-md" style="font-weight: 500;">

            <div class="col-md-3 form-labels font-med-bold text-center" style="font-size: 20px; padding-top: 0.5%;">
                <label>{{image_form.project.label}}</label>
            </div>
            <form method="post">
                 <div id="projectType" class="col-md-3 form-labels text-center">
                    <!--<label>{{image_form.project_type(style="width:100%; height: 100%;", type="Submit")}}</label>-->
                     <ul class="nav nav-pills nav-fill tabs">
                        <a class="nav-link active" aria-current="page" href="#" data-tab-value="#tab_1" name="new_upload">New</a>
                        <a class="nav-link" href="#" data-tab-value="#tab_2" name="existing_upload">Existing</a>
                    </ul>
                </div>
            </form>
        </div>
    <form method="post" action="" class="" enctype="multipart/form-data"><!-- enctype="multipart/form-data"-->
        <div class="row justify-content-center text-md" style="font-weight: 500;">

            <div class="col-md-3 form-labels" id="tab_2" data-tab-info>
                {{ image_form.project(style="width:100%; height: 100%;") }}
            </div>
            <div class="col-md-3 form-labels active" id="tab_1" data-tab-info style="">
                <div class="col-md form-labels">
                    {{ image_form.new_project(style="width:100%; height: 100%;", placeholder="New Project Name") }}
                </div>
                <div class="col-md form-labels">
                    {{ image_form.town(style="width:100%; height: 100%;", placeholder="Town") }}
                </div>
                <div class="col-md form-labels">
                    {{ image_form.owners_email(style="width:100%; height: 100%;", placeholder="Owner's Email") }}
                </div>
                <div class="col-md form-labels">
                    {{ image_form.project_date(style="width:100%; height: 100%;", placeholder="Project Date") }}
                </div>
            </div>

             <div class="col-md-3 form-labels">
                {{ render_field(image_form.image, class="form-control", style="margin-top: -5%;", multiple="multiple") }}
            </div>
        </div>
        <div class="row justify-content-center text-center">
            <div class="col-md">
                <button class="buttons btn btn-outline-primary"
                    data-callback='onSubmit'
                    data-action='submit'
                    name="upload-image">Upload</button>
                <!--<p class="buttons"><input type="Submit" class="btn btn-outline" value="Send"></p>-->
            </div>
        </div>
    </form>
</div>
<script>
    const tabs = document.querySelectorAll('[data-tab-value]')
    const tabInfos = document.querySelectorAll('[data-tab-info]')

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelector('.active')?.classList.remove('active');
            tab.classList.add('active');
            const target = document
                .querySelector(tab.dataset.tabValue);
            tabInfos.forEach(tabInfo => {
                tabInfo.classList.remove('active')
            })
            target.classList.add('active');
            document.querySelector('.active')?.classList.remove('active');
            tab.classList.add('active');
        })
    })



 </script>

<div class="container-md admin-forms" style="padding-top: 10px;">
    <h2 class="display-6">Pending Testimonials</h2>
    <div class="container-md" style="padding-top: 20px;">
        {% if pending_testimonials %}
        <table class="table table-hover table-light testimonial-table" align="center">
            <thead>
            </thead>
            <tbody>
                {% for i in pending_testimonials %}
                <tr>
                    <!--<th scope="row">1</th>-->
                  <td class="testimonial-column">
                      <h3>{{i.name}}<small class="text-muted"> ({{ email }}) </small></h3>
                      <p><i> {{i.town}}, NH</i></p>
                      <p class="testimonial-content text-center">"{{i.message}}"</p>
                  </td>
                  <td class="button-column">
                      <form action="{{ url_for('blueprint.approve_testimonial', testimonial_id=i.testimonial_id) }}" method="post" class="buttons">
                          <input type="submit" value="Approve" name="approve-button" onclick="return confirm('Are you sure you want to approve this entry?');" class="btn btn-success">
                      </form>
                  </td>
                  <td class="button-column">
                      <form action="{{ url_for('blueprint.delete_testimonial_request', testimonial_id=i.testimonial_id) }}" method="post" class="buttons">
                          <input type="submit" value="Delete" name="delete-button" onclick="return confirm('Are you sure you want to delete this testimonial?');" class="btn btn-danger">
                      </form>
                  </td>
                </tr>
            {% endfor %}

            </tbody>
        </table>

        {% else %}
         <br>
         <h3 align="center">There's nothing pending right now.</h3>
        {% endif %}

    </div>

</div>



{% endblock %}
